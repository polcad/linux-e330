#!/bin/bash
# Linux Setup Script (LSS)
# Author: iseijin
# Date: 13/05/2013
# Description: Use git to retrieve various Linux Configuration files from a repository on github.
#+++++++++++++++++++++
#       ~/.bashrc
#       ~/.bash_aliases
#       ~/.vimrc
#       ~/.Xresources
#       ~/.vim/
#+++++++++++++++++++++
# This script runs from ~/bin - create the directory if it doesn't exist or modify the file to reflect where you want your scripts folder e.g. ~/scripts, /usr/bin

if eval "ping -c 1 www.google.com > /dev/null"; then
  :
else
  echo "I require an internet connection but cannot find one. Aborting."
  exit 1
fi

# Test if git is installed
command -v git >/dev/null 2>&1 || { echo >&2 "I require git but it's not installed.  Aborting."; exit 1;  }

# Verify repo exists
cd ~/bin/LSS && git show-ref > /dev/null
verify=$?
if [ $verify -eq 0 ]; then
  echo "The LSS git already exists, continuing..."
  self_delete=false
else  
  self_delete=true # Delete this file as the real copy will be retrieved with git
  printf "This script cannot be run without the Git repo, the following command will be run first:\ngit clone git@github.com:iseijin/LSS.git ~/bin/LSS"
  git clone git@github.com:iseijin/LSS.git ~/bin/LSS
fi

# Create sym links to files in LSS/configFiles
FILES=".bashrc
.bash_aliases
.vimrc
.Xresources
"
for f in $FILES
do
  testname=$f
  backup=$testname.backup
  if [ ! -L ~/$testname ] && [ -e ~/$testname ]; then # Backup if it is a FILE and NOT a link
    if [ -e ~/$backup ]; then
      i=2
      while [ -e ~/$backup$i ]; do
        let i++
      done
      name=$backup$i
    fi
    echo "Backing up ~/.bashrc to ~/$backup"
    mv ~/$testname $fpath/$backup
    echo "Creating link for ~/.bashrc"
    ln -s ~/bin/LSS/configFiles/$testname ~/$testname
  elif [ -L ~/$testname ] # If file is a LINK
    echo "Creating link for ~/.bashrc"
    ln -sf ~/bin/LSS/configFiles/$testname ~/$testname
  fi
done

######
# if [ ! -L ~/.bash_aliases ]; then
#   echo "Creating link for ~/.bash_aliases"
#   ln -s ~/bin/LSS/configFiles/.bash_aliases ~/.bash_aliases
# fi
# 
# if [ ! -L ~/.vimrc ]; then
#   echo "Creating link for ~/.vimrc"
#   ln -s ~/bin/LSS/configFiles/.vimrc ~/.vimrc
# fi
# 
# if [ ! -L ~/.Xresources ]; then
#   echo "Creating link for ~/.Xresources"
#   ln -s ~/bin/LSS/configFiles/.Xresources ~/.Xresources
# fi
# 
# if [ -d ~/.vim ]; then
#   if [ -L ~/.vim ]; then
#     echo "Creating link for ~/.vim"
#     ln -s ~/bin/LSS/configFiles/.vim ~/.vim
#   else
#     echo "Backing up .vim to .vimbackup"
#     mv ~/.vim ~/.vim
#   fi
# fi

if $self_delete ; then
  echo "Deleting $0"
  rm $0
fi
